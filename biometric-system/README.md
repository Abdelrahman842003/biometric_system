# نظام إدارة أجهزة البايومترك

نظام شامل لإدارة أجهزة البصمة والوجه باستخدام PHP مع دعم ADMS و SDK للتحكم الكامل.

## 🚀 البدء السريع - طرق التشغيل

### الطريقة الأولى: تشغيل مباشر (الأسهل) ⚡
```bash
./start.sh
```
سيقوم هذا الأمر بتشغيل خادم PHP محلي تلقائياً وإظهار الرابط للوصول للنظام.

### الطريقة الثانية: التثبيت الكامل 🔧
```bash
./run.sh
```
يقوم بالتثبيت الكامل وتشغيل الخادم مع عرض تعليمات مفصلة.

### الطريقة الثالثة: تشغيل خادم PHP يدوياً 💻
```bash
cd biometric-system
php -S localhost:8000
```
ثم اذهب إلى: http://localhost:8000/

### الطريقة الرابعة: استخدام خادم ويب (Apache/Nginx) 🌐
- انسخ مجلد `biometric-system` إلى مجلد الخادم (htdocs/www)
- اذهب إلى: http://localhost:8000/biometric-system/

## 📁 ملفات التشغيل والمساعدة

| الملف | الوصف | الاستخدام |
|-------|--------|-----------|
| `start.sh` | 🚀 تشغيل مباشر وبسيط | `./start.sh` |
| `run.sh` | 🔧 تثبيت كامل مع التشغيل | `./run.sh` |
| `status.sh` | 📊 فحص حالة النظام | `./status.sh` |
| `help.sh` | ❓ مساعدة سريعة | `./help.sh` |
| `setup.php` | ⚡ تثبيت سريع لقاعدة البيانات | `php setup.php` |
| `install.php` | 🎯 مثبت تفاعلي عبر المتصفح | عبر المتصفح |

## 🎯 الوصول للنظام
```
https://yourserver.com/
```
ستظهر الصفحة الرئيسية مع:
- معلومات النظام وحالته
- رابط مباشر للوحة التحكم
- فحص حالة المكونات
- **زر تثبيت قاعدة البيانات** (إذا لم تكن مثبتة)

### 3. دخول لوحة التحكم
```
Username: admin
Password: password
```

## 🔧 استخدام النظام

### 1️⃣ إدارة الأجهزة
- إضافة وتعديل وحذف الأجهزة
- اختبار الاتصال (Ping/Port)
- عرض معلومات الجهاز (الموديل، الإصدار، عدد المستخدمين)
- إعادة تشغيل الجهاز عبر SDK
- مزامنة الوقت عبر SDK

### 2️⃣ إدارة المستخدمين
- إضافة/تعديل/حذف المستخدمين
- رفع قوالب البصمة والوجه
- رفع البيانات للجهاز عبر SDK
- حذف المستخدم من الجهاز عبر SDK

### 3️⃣ سجل الحضور
- استقبال السجلات عبر ADMS تلقائياً
- عرض السجلات مع التصفية
- تصدير السجلات (CSV, PDF)
- إحصائيات مفصلة

### 4️⃣ نظام الأوامر
- إنشاء أوامر للأجهزة
- معالجة الأوامر عبر SDK
- متابعة حالة تنفيذ الأوامر

### 5️⃣ الأمان المتقدم
- HTTPS إجباري
- حماية endpoint مع token
- تشفير كلمات المرور
- تسجيل العمليات

## 🏗️ هيكل المشروع

```
your-project-name/
├── index.php               # 🏠 نقطة البداية - الصفحة الرئيسية
├── config/
│   └── database.php          # إعدادات قاعدة البيانات
├── models/                   # نماذج البيانات
│   ├── Machine.php
│   ├── User.php
│   ├── AttendanceLog.php
│   └── Command.php
├── sdk/
│   └── ZKTeco.php           # SDK للتواصل مع الأجهزة
├── api/                     # واجهات API
│   ├── adms-endpoint.php    # استقبال بيانات ADMS
│   ├── dashboard-stats.php
│   ├── recent-activity.php
│   ├── test-connection.php
│   └── system-status.php    # حالة النظام
├── admin/                   # لوحة التحكم
│   ├── dashboard.php
│   ├── machines.php
│   ├── users.php
│   └── attendance.php
├── cron/
│   └── command-processor.php # معالج الأوامر
├── database/
│   └── schema.sql           # بنية قاعدة البيانات
├── logs/                    # ملفات السجلات
└── .htaccess               # إعدادات الأمان
```

## 🚀 التثبيت والإعداد

### 1. متطلبات النظام
- PHP 7.4+ مع extensions: PDO, MySQLi, sockets
- MySQL 5.7+
- Apache/Nginx مع mod_rewrite
- SSL Certificate (للأمان)

### 2. إعداد قاعدة البيانات
هناك عدة طرق لتطبيق schema قاعدة البيانات:

#### الطريقة الأولى: التثبيت التلقائي (الأسهل)
```bash
# من سطر الأوامر
php setup.php
```

#### الطريقة الثانية: من المتصفح
1. اذهب إلى: `http://localhost:8000/install.php`
2. اضغط على "تثبيت قاعدة البيانات"
3. انتظر حتى اكتمال العملية

#### الطريقة الثالثة: يدوياً
```sql
-- تشغيل من MySQL command line
mysql -u root -p < database/schema.sql
```

### 3. تكوين الإعدادات
```php
// config/database.php
define('DB_HOST', 'localhost');
define('DB_NAME', 'biometric_system');
define('DB_USER', 'your_username');
define('DB_PASS', 'your_password');
define('SECRET_KEY', 'your-secret-key-here');
define('ADMS_TOKEN', 'your-adms-token-here');
```

### 4. إعداد صلاحيات المجلدات
```bash
chmod 755 logs/
chmod 644 .htaccess
chown -R www-data:www-data your-project-name/
```

### 5. إعداد Cron للأوامر
```bash
# إضافة لـ crontab لمعالجة الأوامر كل دقيقة
* * * * * php /path/to/your-project/cron/command-processor.php
```

## � البدء السريع

### 1. الوصول للنظام
```
https://yourserver.com/
```
ستظهر الصفحة الرئيسية مع:
- معلومات النظام وحالته
- رابط مباشر للوحة التحكم
- فحص حالة المكونات

### 2. دخول لوحة التحكم
```
https://yourserver.com/admin/dashboard.php
```

## �🔧 استخدام النظام

### إدارة الأجهزة
1. اذهب إلى لوحة التحكم > إدارة الأجهزة
2. أضف جهاز جديد بالمعلومات المطلوبة
3. اختبر الاتصال للتأكد من التكوين
4. فعّل ADMS لاستقبال البيانات تلقائياً

### إعداد ADMS في الجهاز
```
ADMS URL: https://yourserver.com/api/adms-endpoint.php
Token: your-adms-token-here
```

### استخدام API
```php
// استقبال سجل حضور عبر ADMS
POST /api/adms-endpoint.php
{
    "action": "attendance",
    "machine_ip": "192.168.1.100",
    "user_id": "001",
    "timestamp": "2024-01-15 08:30:00",
    "log_type": "check_in",
    "verify_type": "fingerprint",
    "token": "your-adms-token"
}
```

## 🛡️ الأمان

### تأمين ADMS Endpoint
- استخدام HTTPS إجباري
- التحقق من Token في كل طلب
- تسجيل جميع المحاولات
- تشفير البيانات الحساسة

### حماية لوحة التحكم
- تسجيل دخول بكلمة مرور مشفرة
- جلسات آمنة مع انتهاء صلاحية
- حماية من CSRF attacks
- تسجيل العمليات الإدارية

## 📊 التقارير والإحصائيات

### تقارير الحضور
- تقرير يومي/أسبوعي/شهري
- تصفية حسب المستخدم/الجهاز
- تصدير للـ CSV/PDF
- إحصائيات متقدمة

### مراقبة الأجهزة
- حالة الاتصال لكل جهاز
- آخر تزامن للبيانات
- عدد المستخدمين المسجلين
- سجل الأوامر المرسلة

## 🔧 استكشاف الأخطاء

### مشاكل شائعة
1. **فشل الاتصال بالجهاز**: تحقق من IP والمنفذ
2. **عدم استقبال البيانات**: تحقق من إعدادات ADMS
3. **أخطاء قاعدة البيانات**: تحقق من صلاحيات المستخدم
4. **مشاكل SSL**: تأكد من صحة الشهادة

### ملفات السجلات
- `logs/adms_YYYY-MM-DD.log` - سجل استقبال البيانات
- `logs/commands_YYYY-MM-DD.log` - سجل تنفيذ الأوامر
- `logs/system_YYYY-MM-DD.log` - سجل النظام العام

## 🚀 التطوير والتحسين

### إضافة مميزات جديدة
1. إضافة دعم لأجهزة أخرى غير ZKTeco
2. تطوير تطبيق موبايل
3. إضافة تقارير متقدمة
4. تكامل مع أنظمة HR

### الأداء والتحسين
- استخدام Redis للتخزين المؤقت
- تحسين استعلامات قاعدة البيانات
- ضغط البيانات المرسلة
- تحسين واجهة المستخدم

## 📞 الدعم والمساعدة

للحصول على المساعدة أو الإبلاغ عن مشاكل:
- تحقق من ملفات السجلات أولاً
- راجع التوثيق المفصل
- تواصل مع فريق التطوير

---

## 📝 ملاحظات مهمة

- **الأمان**: استخدم HTTPS دائماً في بيئة الإنتاج
- **النسخ الاحتياطي**: قم بعمل نسخة احتياطية من قاعدة البيانات بانتظام
- **التحديثات**: تابع التحديثات الأمنية للنظام
- **المراقبة**: راقب ملفات السجلات بانتظام للتأكد من سلامة النظام

تم تطوير هذا النظام وفقاً لأفضل ممارسات الأمان والأداء مع الحفاظ على سهولة الاستخدام والصيانة.
